<Page x:Class="Uno_Platform.Views.ProductEditPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:components="using:Uno_Platform.Components"
      xmlns:converters="using:Uno_Platform.Converters"
      Background="{StaticResource BackgroundGradientBrush}">
  
  <Page.Resources>
    <!-- Page Enter Animation -->
    <Storyboard x:Name="PageEnterAnimation">
      <DoubleAnimation Storyboard.TargetName="ContentGrid"
                      Storyboard.TargetProperty="Opacity"
                      From="0"
                      To="1"
                      Duration="0:0:0.5">
        <DoubleAnimation.EasingFunction>
          <CubicEase EasingMode="EaseOut"/>
        </DoubleAnimation.EasingFunction>
      </DoubleAnimation>
    </Storyboard>
    
    <!-- Success Animation -->
    <Storyboard x:Name="SaveSuccessAnimation">
      <DoubleAnimation Storyboard.TargetName="SuccessMessage"
                      Storyboard.TargetProperty="Opacity"
                      To="1"
                      Duration="0:0:0.3">
        <DoubleAnimation.EasingFunction>
          <CubicEase EasingMode="EaseOut"/>
        </DoubleAnimation.EasingFunction>
      </DoubleAnimation>
      <DoubleAnimation Storyboard.TargetName="SuccessMessage"
                      Storyboard.TargetProperty="Opacity"
                      To="0"
                      BeginTime="0:0:2"
                      Duration="0:0:0.3">
        <DoubleAnimation.EasingFunction>
          <CubicEase EasingMode="EaseIn"/>
        </DoubleAnimation.EasingFunction>
      </DoubleAnimation>
    </Storyboard>
  </Page.Resources>

  <Grid x:Name="ContentGrid" Opacity="0">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="*"/>
    </Grid.RowDefinitions>

    <!-- Header with Acrylic Background -->
    <Border Grid.Row="0"
            Background="{StaticResource AcrylicBrush}"
            Padding="{StaticResource SpacingL}"
            BorderThickness="0,0,0,1"
            BorderBrush="{StaticResource BorderBrush}">
      <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="{StaticResource SpacingM}">
        <Button Grid.Column="0"
                Style="{StaticResource IconButtonStyle}"
                Background="{StaticResource SurfaceBrush}"
                Foreground="{StaticResource PrimaryBrush}"
                CornerRadius="{StaticResource BorderRadiusMedium}"
                Width="48"
                Height="48"
                Command="{x:Bind ViewModel.GoBackCommand}">
          <SymbolIcon Symbol="Back"/>
        </Button>
        
        <TextBlock Grid.Column="1"
                  Text="{x:Bind ViewModel.IsEditMode, Mode=OneWay, Converter={StaticResource EditModeConverter}}"
                  Style="{StaticResource Heading2Style}"
                  VerticalAlignment="Center"
                  Foreground="{StaticResource TextPrimaryBrush}"/>
      </Grid>
    </Border>

    <!-- Form Content -->
    <ScrollViewer Grid.Row="1" 
                  Padding="{StaticResource SpacingL}"
                  ZoomMode="Disabled"
                  VerticalScrollBarVisibility="Auto"
                  HorizontalScrollBarVisibility="Disabled">
      <StackPanel Spacing="{StaticResource SpacingL}" MaxWidth="800">
        
        <!-- Product Image Preview Card -->
        <Border Background="{StaticResource AcrylicBrush}"
                Padding="{StaticResource SpacingXL}"
                CornerRadius="{StaticResource BorderRadiusXLarge}"
                BorderThickness="2"
                BorderBrush="{StaticResource BorderBrush}">
          <Grid>
            <Border Background="{StaticResource SurfaceBrush}"
                   CornerRadius="{StaticResource BorderRadiusLarge}"
                   Padding="{StaticResource SpacingXL}">
          <Image Source="Assets/img/caby.png"
                 Stretch="Uniform"
                 HorizontalAlignment="Center"
                     VerticalAlignment="Center"
                     MaxHeight="300"
                     MaxWidth="300"
                     Opacity="0.9"/>
            </Border>
            <TextBlock Text="ðŸ“· All products use default image: Assets/img/caby.png"
                       Style="{StaticResource SecondaryTextStyle}"
                       HorizontalAlignment="Center"
                       VerticalAlignment="Bottom"
                       Margin="0,0,0,8"
                       FontStyle="Italic"
                       FontSize="{StaticResource FontSizeSmall}"/>
          </Grid>
        </Border>

        <!-- Form Fields Card -->
        <Border Background="{StaticResource AcrylicBrush}"
                Padding="{StaticResource SpacingXL}"
                CornerRadius="{StaticResource BorderRadiusXLarge}"
                BorderThickness="2"
                BorderBrush="{StaticResource BorderBrush}">
          <StackPanel Spacing="{StaticResource SpacingL}">
            
            <!-- Product Name Field -->
            <StackPanel Spacing="{StaticResource SpacingS}">
              <StackPanel Orientation="Horizontal" Spacing="{StaticResource SpacingXS}">
                <TextBlock Text="ðŸ“ Product Name"
                        Style="{StaticResource Heading3Style}"/>
                <TextBlock Text="*"
                          Foreground="{StaticResource ErrorBrush}"
                          FontSize="20"
                          FontWeight="Bold"
                          VerticalAlignment="Top"/>
              </StackPanel>
              <TextBox Text="{x:Bind ViewModel.Name, Mode=TwoWay}"
                      PlaceholderText="Enter product name (minimum 2 characters)"
                      Style="{StaticResource ModernTextBoxStyle}"
                      FontSize="{StaticResource FontSizeBody}"
                      Padding="16"
                      CornerRadius="{StaticResource BorderRadiusMedium}"
                      BorderThickness="2"
                      BorderBrush="{StaticResource BorderBrush}"/>
            </StackPanel>

            <!-- Price Field -->
            <StackPanel Spacing="{StaticResource SpacingS}">
              <StackPanel Orientation="Horizontal" Spacing="{StaticResource SpacingXS}">
                <TextBlock Text="ðŸ’° Price"
                        Style="{StaticResource Heading3Style}"/>
                <TextBlock Text="*"
                          Foreground="{StaticResource ErrorBrush}"
                          FontSize="20"
                          FontWeight="Bold"
                          VerticalAlignment="Top"/>
              </StackPanel>
              <Grid ColumnDefinitions="Auto,*" ColumnSpacing="{StaticResource SpacingS}">
                <Border Grid.Column="0"
                       Background="{StaticResource PrimaryBrush}"
                       CornerRadius="12,0,0,12"
                       Padding="16,0"
                       VerticalAlignment="Stretch"
                       HorizontalAlignment="Left"
                       MinWidth="60">
                  <TextBlock Text="$"
                            Style="{StaticResource Heading2Style}"
                            Foreground="White"
                            VerticalAlignment="Center"
                            HorizontalAlignment="Center"
                            FontWeight="Bold"/>
                </Border>
                <TextBox Grid.Column="1"
                        Text="{x:Bind ViewModel.Price, Mode=TwoWay}"
                      PlaceholderText="0.00"
                      InputScope="Number"
                      Style="{StaticResource ModernTextBoxStyle}"
                        FontSize="20"
                        FontWeight="SemiBold"
                        Padding="16"
                        CornerRadius="0,12,12,0"
                        BorderThickness="2,2,2,2"
                        BorderBrush="{StaticResource BorderBrush}"
                      TextChanging="PriceTextBox_TextChanging"/>
              </Grid>
            </StackPanel>

            <!-- Category Field -->
            <StackPanel Spacing="{StaticResource SpacingS}">
              <StackPanel Orientation="Horizontal" Spacing="{StaticResource SpacingXS}">
                <TextBlock Text="ðŸ“‚ Category"
                        Style="{StaticResource Heading3Style}"/>
                <TextBlock Text="*"
                          Foreground="{StaticResource ErrorBrush}"
                          FontSize="20"
                          FontWeight="Bold"
                          VerticalAlignment="Top"/>
              </StackPanel>
              <ComboBox ItemsSource="{x:Bind ViewModel.Categories, Mode=OneWay}"
                       SelectedItem="{x:Bind ViewModel.Category, Mode=TwoWay}"
                       PlaceholderText="Select a category"
                       FontSize="{StaticResource FontSizeBody}"
                       Padding="16"
                       CornerRadius="{StaticResource BorderRadiusMedium}"
                       BorderThickness="2"
                       BorderBrush="{StaticResource BorderBrush}"
                       Background="{StaticResource SurfaceBrush}"
                       Foreground="{StaticResource TextPrimaryBrush}">
                <ComboBox.ItemTemplate>
                  <DataTemplate>
                    <TextBlock Text="{Binding}" 
                              FontSize="{StaticResource FontSizeBody}" 
                              Padding="4"
                              Foreground="Black"/>
                  </DataTemplate>
                </ComboBox.ItemTemplate>
              </ComboBox>
            </StackPanel>

            <!-- Description Field -->
            <StackPanel Spacing="{StaticResource SpacingS}">
              <StackPanel Orientation="Horizontal" Spacing="{StaticResource SpacingXS}">
                <TextBlock Text="ðŸ“„ Description"
                        Style="{StaticResource Heading3Style}"/>
                <TextBlock Text="*"
                          Foreground="{StaticResource ErrorBrush}"
                          FontSize="20"
                          FontWeight="Bold"
                          VerticalAlignment="Top"/>
              </StackPanel>
              <TextBox Text="{x:Bind ViewModel.Description, Mode=TwoWay}"
                      PlaceholderText="Enter detailed product description..."
                      Style="{StaticResource ModernTextBoxStyle}"
                      TextWrapping="Wrap"
                      AcceptsReturn="True"
                      MinHeight="160"
                      FontSize="{StaticResource FontSizeBody}"
                      Padding="16"
                      CornerRadius="{StaticResource BorderRadiusMedium}"
                      BorderThickness="2"
                      BorderBrush="{StaticResource BorderBrush}"/>
            </StackPanel>

            <!-- Error Message Card -->
            <Border Background="#FFFEE2E2"
                   BorderBrush="{StaticResource ErrorBrush}"
                   BorderThickness="2"
                   Padding="{StaticResource SpacingM}"
                   CornerRadius="{StaticResource BorderRadiusMedium}"
                   Visibility="{x:Bind ViewModel.ErrorMessage, Converter={StaticResource StringToVisibilityConverter}}">
              <StackPanel Orientation="Horizontal" Spacing="{StaticResource SpacingS}">
                <TextBlock Text="âš ï¸"
                          FontSize="24"
                          VerticalAlignment="Center"/>
            <TextBlock Text="{x:Bind ViewModel.ErrorMessage, Mode=OneWay}"
                      Foreground="{StaticResource ErrorBrush}"
                          Style="{StaticResource BodyTextStyle}"
                          TextWrapping="Wrap"
                          FontWeight="SemiBold"
                          VerticalAlignment="Center"/>
              </StackPanel>
            </Border>

          </StackPanel>
        </Border>

        <!-- Action Buttons Card -->
        <Border Background="{StaticResource AcrylicBrush}"
                Padding="{StaticResource SpacingXL}"
                CornerRadius="{StaticResource BorderRadiusXLarge}"
                BorderThickness="2"
                BorderBrush="{StaticResource BorderBrush}">
          <Grid ColumnDefinitions="*,*" ColumnSpacing="{StaticResource SpacingM}">
            
            <!-- Cancel Button -->
            <Button Grid.Column="0"
                   Content="âŒ Cancel"
                   Style="{StaticResource NeutralButtonStyle}"
                   Height="56"
                   Command="{x:Bind ViewModel.GoBackCommand}"/>
            
            <!-- Save Button -->
            <Button Grid.Column="1"
                   Content="ðŸ’¾ Save Product"
                   Style="{StaticResource PrimaryButtonStyle}"
                   Height="56"
                   Command="{x:Bind ViewModel.SaveCommand}"/>

          </Grid>
        </Border>

      </StackPanel>
    </ScrollViewer>

    <!-- Success Message -->
    <Border x:Name="SuccessMessage"
            Opacity="0"
            Background="{StaticResource SuccessBrush}"
            Padding="{StaticResource SpacingXL}"
            CornerRadius="{StaticResource BorderRadiusXLarge}"
            HorizontalAlignment="Center"
            VerticalAlignment="Center"
            Margin="{StaticResource SpacingL}"
            BorderThickness="0">
      <StackPanel Orientation="Horizontal" Spacing="{StaticResource SpacingM}">
        <TextBlock Text="âœ…"
                  FontSize="36"
                  VerticalAlignment="Center"/>
      <TextBlock Text="Product saved successfully!"
                Foreground="White"
                  Style="{StaticResource Heading2Style}"
                  FontWeight="Bold"
                  VerticalAlignment="Center"/>
      </StackPanel>
    </Border>

    <!-- Loading Overlay -->
    <components:LoadingIndicator Grid.Row="1"
                                IsLoading="{x:Bind ViewModel.IsLoading, Mode=OneWay}"
                              Message="Saving product..."/>
  </Grid>
</Page>

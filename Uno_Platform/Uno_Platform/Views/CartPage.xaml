<Page x:Class="Uno_Platform.Views.CartPage"
      x:Name="PageRoot"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:components="using:Uno_Platform.Components"
      xmlns:models="using:Uno_Platform.Models"
      xmlns:converters="using:Uno_Platform.Converters"
      Background="{StaticResource BackgroundGradientBrush}">
  
  <Page.Resources>
    <!-- Page Enter Animation -->
    <Storyboard x:Name="PageEnterAnimation">
      <DoubleAnimation Storyboard.TargetName="ContentGrid"
                      Storyboard.TargetProperty="Opacity"
                      From="0"
                      To="1"
                      Duration="0:0:0.5">
        <DoubleAnimation.EasingFunction>
          <CubicEase EasingMode="EaseOut"/>
        </DoubleAnimation.EasingFunction>
      </DoubleAnimation>
    </Storyboard>
  </Page.Resources>

  <Grid x:Name="ContentGrid" Opacity="0">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="*"/>
    </Grid.RowDefinitions>
    
    <!-- Header with Acrylic Background -->
    <Border Grid.Row="0"
            Background="{StaticResource AcrylicBrush}"
            Padding="{StaticResource SpacingL}"
            BorderThickness="0,0,0,1"
            BorderBrush="{StaticResource BorderBrush}">
      <Grid ColumnDefinitions="Auto,*" ColumnSpacing="{StaticResource SpacingM}">
        <Button Grid.Column="0"
                Style="{StaticResource IconButtonStyle}"
                Background="{StaticResource SurfaceBrush}"
                Foreground="{StaticResource PrimaryBrush}"
                CornerRadius="{StaticResource BorderRadiusMedium}"
                Width="48"
                Height="48"
                Command="{x:Bind ViewModel.GoBackCommand}">
          <SymbolIcon Symbol="Back"/>
        </Button>
        
        <StackPanel Grid.Column="1"
                   VerticalAlignment="Center">
          <TextBlock Text="ðŸ›’ Shopping Cart"
                  Style="{StaticResource Heading2Style}"
                    Foreground="{StaticResource TextPrimaryBrush}"/>
          <TextBlock Text="{x:Bind ViewModel.TotalItemsFormatted, Mode=OneWay}"
                    Style="{StaticResource SecondaryTextStyle}"
                    Margin="0,4,0,0"
                    Foreground="{StaticResource TextSecondaryBrush}"/>
        </StackPanel>
      </Grid>
    </Border>

    <!-- Main Content Area -->
    <Grid Grid.Row="1">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="400"/>
        </Grid.ColumnDefinitions>

        <!-- Cart Items -->
        <ScrollViewer Grid.Column="0" 
                      Padding="{StaticResource SpacingL}"
                      ZoomMode="Disabled"
                      VerticalScrollBarVisibility="Auto"
                      HorizontalScrollBarVisibility="Disabled">
          <Grid>
            <!-- Items List -->
            <ItemsControl ItemsSource="{x:Bind ViewModel.CartItems, Mode=OneWay}"
                         x:Name="CartItemsControl">
              <ItemsControl.ItemsPanel>
                <ItemsPanelTemplate>
                  <StackPanel Spacing="{StaticResource SpacingL}"/>
                </ItemsPanelTemplate>
              </ItemsControl.ItemsPanel>
              <ItemsControl.ItemTemplate>
                <DataTemplate x:DataType="models:CartItem">
                  <components:CartItemCard CartItem="{x:Bind}"
                                          IncreaseQuantityCommand="{Binding ViewModel.UpdateQuantityCommand, ElementName=PageRoot}"
                                          DecreaseQuantityCommand="{Binding ViewModel.UpdateQuantityCommand, ElementName=PageRoot}"
                                          RemoveItemCommand="{Binding ViewModel.RemoveItemCommand, ElementName=PageRoot}"/>
                </DataTemplate>
              </ItemsControl.ItemTemplate>
            </ItemsControl>

            <!-- Empty State -->
            <Border x:Name="EmptyStateBorder"
                    Background="{StaticResource AcrylicBrush}"
                    Padding="{StaticResource SpacingXXL}"
                    HorizontalAlignment="Stretch"
                    VerticalAlignment="Center"
                    CornerRadius="{StaticResource BorderRadiusXLarge}"
                    BorderThickness="2"
                    BorderBrush="{StaticResource BorderBrush}"
                    Visibility="{x:Bind ViewModel.CartItems.Count, Converter={StaticResource CountToVisibilityConverter}, ConverterParameter=Inverse}">
              <StackPanel Spacing="{StaticResource SpacingL}" HorizontalAlignment="Center">
                <TextBlock Text="ðŸ›’"
                          FontSize="96"
                          HorizontalAlignment="Center"
                          Opacity="0.6"/>
                <TextBlock Text="Your cart is empty"
                           Style="{StaticResource Heading2Style}"
                           HorizontalAlignment="Center"/>
                <TextBlock Text="Add some amazing products to get started shopping!"
                           Style="{StaticResource SecondaryTextStyle}"
                          HorizontalAlignment="Center"
                          TextAlignment="Center"
                          TextWrapping="Wrap"
                          MaxWidth="400"/>
                <Button Content="ðŸ›ï¸ Browse Products"
                       Style="{StaticResource PrimaryButtonStyle}"
                       Margin="0,16,0,0"
                       Padding="32,16"
                       FontSize="{StaticResource FontSizeBody}"
                       FontWeight="SemiBold"
                       HorizontalAlignment="Center"
                       Command="{x:Bind ViewModel.ContinueShoppingCommand}"/>
              </StackPanel>
            </Border>
          </Grid>
        </ScrollViewer>

        <!-- Total and Checkout Panel - Sidebar -->
        <Border Grid.Column="1"
                Background="{StaticResource SurfaceBrush}"
                Padding="{StaticResource SpacingXL}"
                Margin="0,24,24,24"
                CornerRadius="{StaticResource BorderRadiusXLarge}"
                BorderThickness="1"
                BorderBrush="{StaticResource BorderBrush}"
                VerticalAlignment="Top">
          
          <Grid>
            <!-- Main Content -->
            <StackPanel Spacing="{StaticResource SpacingL}">
              <TextBlock Text="Order Summary" 
                         Style="{StaticResource Heading3Style}"
                         Margin="0,0,0,8"/>

              <!-- Total Section -->
              <Border Background="{StaticResource BackgroundBrush}"
                     Padding="{StaticResource SpacingM}"
                     CornerRadius="{StaticResource BorderRadiusMedium}">
                <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto,Auto">
                  
                  <!-- Subtotal Row -->
                  <TextBlock Grid.Row="0" Grid.Column="0"
                            Text="Subtotal"
                            Style="{StaticResource BodyTextStyle}"
                            Foreground="{StaticResource TextSecondaryBrush}"/>
                  <TextBlock Grid.Row="0" Grid.Column="1"
                            Text="{x:Bind ViewModel.TotalPrice, Mode=OneWay, Converter={StaticResource PriceFormatConverter}}"
                            Style="{StaticResource BodyTextStyle}"
                            FontWeight="SemiBold"
                            HorizontalAlignment="Right"/>
                  
                  <!-- Tax Row (Placeholder) -->
                   <TextBlock Grid.Row="1" Grid.Column="0"
                            Text="Tax (Estimated)"
                            Style="{StaticResource BodyTextStyle}"
                            Foreground="{StaticResource TextSecondaryBrush}"
                            Margin="0,8,0,0"/>
                  <TextBlock Grid.Row="1" Grid.Column="1"
                            Text="$0.00"
                            Style="{StaticResource BodyTextStyle}"
                            FontWeight="SemiBold"
                            HorizontalAlignment="Right"
                            Margin="0,8,0,0"/>

                  <!-- Divider -->
                  <Border Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2"
                         Height="1"
                         Background="{StaticResource BorderBrush}"
                         Margin="0,16,0,16"
                         HorizontalAlignment="Stretch"/>
                </Grid>
              </Border>

               <Grid ColumnDefinitions="*,*">
                  <TextBlock Grid.Column="0"
                        Text="Total"
                        Style="{StaticResource Heading2Style}"
                        VerticalAlignment="Center"/>
                  <TextBlock Grid.Column="1"
                            Text="{x:Bind ViewModel.TotalPrice, Mode=OneWay, Converter={StaticResource PriceFormatConverter}}"
                            Style="{StaticResource Heading2Style}"
                            Foreground="{StaticResource PrimaryBrush}"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Center"/>
               </Grid>

              <!-- Checkout Button -->
              <Button Content="Proceed to Checkout"
                   Style="{StaticResource PrimaryButtonStyle}"
                     HorizontalAlignment="Stretch"
                   Command="{x:Bind ViewModel.CheckoutCommand}"
                     IsEnabled="{x:Bind ViewModel.CartItems.Count, Mode=OneWay}"
                     Margin="0,8,0,0"/>

              <!-- Clear Cart Button -->
              <Button Content="Clear Cart"
                     Style="{StaticResource GhostButtonStyle}"
                     Command="{x:Bind ViewModel.ClearCartCommand}"
                     IsEnabled="{x:Bind ViewModel.CartItems.Count, Mode=OneWay}"
                     HorizontalAlignment="Center"/>

          </StackPanel>
          </Grid>
        </Border>
    </Grid>

    <!-- Loading Overlay -->
    <components:LoadingIndicator Grid.Row="1"
                                IsLoading="{x:Bind ViewModel.IsLoading, Mode=OneWay}"
                               Message="Loading cart..."/>
  </Grid>
</Page>

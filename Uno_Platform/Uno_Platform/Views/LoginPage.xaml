<Page x:Class="Uno_Platform.Views.LoginPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:local="using:Uno_Platform.Views"
      xmlns:components="using:Uno_Platform.Components"
      Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">
  <Grid x:Name="RootGrid">
    <!-- Background Gradient -->
    <Grid.Background>
      <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
        <GradientStop Color="#F8FAFC" Offset="0"/>
        <GradientStop Color="#E2E8F0" Offset="1"/>
      </LinearGradientBrush>
    </Grid.Background>

    <!-- Visual States for Responsive Design -->
    <VisualStateManager.VisualStateGroups>
      <VisualStateGroup x:Name="AdaptiveStates">
        <!-- Large screens (Desktop) -->
        <VisualState x:Name="WideState">
          <VisualState.StateTriggers>
            <AdaptiveTrigger MinWindowWidth="720"/>
          </VisualState.StateTriggers>
          <VisualState.Setters>
            <Setter Target="LoginCard.Width" Value="400"/>
            <Setter Target="LoginCard.Padding" Value="40"/>
            <Setter Target="ContentWrapper.Padding" Value="20"/>
            <Setter Target="HeaderIcon.Width" Value="64"/>
            <Setter Target="HeaderIcon.Height" Value="64"/>
            <Setter Target="HeaderIcon.CornerRadius" Value="32"/>
            <Setter Target="HeaderIconSymbol.RenderTransform" Value="{StaticResource LargeIconTransform}"/>
            <Setter Target="BackButton.Margin" Value="-20,-20,0,0"/>
            <Setter Target="FormContent.Spacing" Value="24"/>
          </VisualState.Setters>
        </VisualState>

        <!-- Medium screens (Tablet) -->
        <VisualState x:Name="MediumState">
          <VisualState.StateTriggers>
            <AdaptiveTrigger MinWindowWidth="480"/>
          </VisualState.StateTriggers>
          <VisualState.Setters>
            <Setter Target="LoginCard.Width" Value="380"/>
            <Setter Target="LoginCard.Padding" Value="32"/>
            <Setter Target="ContentWrapper.Padding" Value="16"/>
            <Setter Target="HeaderIcon.Width" Value="56"/>
            <Setter Target="HeaderIcon.Height" Value="56"/>
            <Setter Target="HeaderIcon.CornerRadius" Value="28"/>
            <Setter Target="HeaderIconSymbol.RenderTransform" Value="{StaticResource MediumIconTransform}"/>
            <Setter Target="BackButton.Margin" Value="-16,-16,0,0"/>
            <Setter Target="FormContent.Spacing" Value="20"/>
          </VisualState.Setters>
        </VisualState>

        <!-- Small screens (Mobile) -->
        <VisualState x:Name="NarrowState">
          <VisualState.StateTriggers>
            <AdaptiveTrigger MinWindowWidth="0"/>
          </VisualState.StateTriggers>
          <VisualState.Setters>
            <Setter Target="LoginCard.Width" Value="NaN"/>
            <Setter Target="LoginCard.HorizontalAlignment" Value="Stretch"/>
            <Setter Target="LoginCard.Padding" Value="24,28"/>
            <Setter Target="LoginCard.CornerRadius" Value="16"/>
            <Setter Target="ContentWrapper.Padding" Value="16,24"/>
            <Setter Target="HeaderIcon.Width" Value="48"/>
            <Setter Target="HeaderIcon.Height" Value="48"/>
            <Setter Target="HeaderIcon.CornerRadius" Value="24"/>
            <Setter Target="HeaderIcon.Margin" Value="0,0,0,12"/>
            <Setter Target="HeaderIconSymbol.RenderTransform" Value="{StaticResource SmallIconTransform}"/>
            <Setter Target="BackButton.Margin" Value="-12,-12,0,0"/>
            <Setter Target="FormContent.Spacing" Value="16"/>
            <Setter Target="WelcomeText.FontSize" Value="22"/>
            <Setter Target="SubtitleText.FontSize" Value="13"/>
            <Setter Target="PasswordInputBox.Height" Value="44"/>
          </VisualState.Setters>
        </VisualState>
      </VisualStateGroup>
    </VisualStateManager.VisualStateGroups>

    <!-- Resources for transforms -->
    <Grid.Resources>
      <ScaleTransform x:Key="LargeIconTransform" ScaleX="1.5" ScaleY="1.5"/>
      <ScaleTransform x:Key="MediumIconTransform" ScaleX="1.3" ScaleY="1.3"/>
      <ScaleTransform x:Key="SmallIconTransform" ScaleX="1.1" ScaleY="1.1"/>
    </Grid.Resources>

    <ScrollViewer VerticalScrollBarVisibility="Auto"
                  HorizontalScrollBarVisibility="Disabled">
      <StackPanel x:Name="ContentWrapper"
                  HorizontalAlignment="Center" 
                  VerticalAlignment="Center"
                  Padding="20"
                  MaxWidth="440">
        
        <!-- Login Card -->
        <Border x:Name="LoginCard"
                Background="{StaticResource SurfaceBrush}"
                CornerRadius="{StaticResource BorderRadiusLarge}"
                Padding="40"
                Width="400"
                MaxWidth="440"
                BorderBrush="{StaticResource BorderBrush}"
                BorderThickness="1"
                Shadow="{StaticResource SharedShadow}"
                Translation="0,0,32">
          <Border.Resources>
            <ThemeShadow x:Name="SharedShadow"/>
          </Border.Resources>

          <StackPanel x:Name="FormContent" Spacing="24">
            <!-- Header -->
            <Grid>
                <Button x:Name="BackButton"
                        Click="BackButton_Click"
                        Style="{StaticResource IconButtonStyle}"
                        HorizontalAlignment="Left"
                        VerticalAlignment="Top"
                        Margin="-20,-20,0,0">
                    <SymbolIcon Symbol="Back"/>
                </Button>
                
                <StackPanel Spacing="8" HorizontalAlignment="Center" Margin="0,0,0,8">
                  <Border x:Name="HeaderIcon"
                          Width="64" 
                          Height="64" 
                          CornerRadius="32" 
                          Background="{StaticResource PrimaryGradientBrush}"
                          Margin="0,0,0,16"
                          HorizontalAlignment="Center">
                    <SymbolIcon x:Name="HeaderIconSymbol" 
                                Symbol="Contact" 
                                Foreground="White" 
                                RenderTransformOrigin="0.5,0.5">
                      <SymbolIcon.RenderTransform>
                        <ScaleTransform ScaleX="1.5" ScaleY="1.5"/>
                      </SymbolIcon.RenderTransform>
                    </SymbolIcon>
                  </Border>
                  
                  <TextBlock x:Name="WelcomeText"
                             Text="Chào mừng trở lại" 
                             Style="{StaticResource Heading2Style}"
                             HorizontalAlignment="Center"
                             TextAlignment="Center"/>
                  
                  <TextBlock x:Name="SubtitleText"
                             Text="Đăng nhập để tiếp tục" 
                             Style="{StaticResource SecondaryTextStyle}"
                             HorizontalAlignment="Center"
                             TextAlignment="Center"/>
                </StackPanel>
            </Grid>

            <!-- Form -->
            <StackPanel Spacing="16">
              <!-- Username -->
              <StackPanel Spacing="8">
                <TextBlock Text="Tên đăng nhập" 
                           Style="{StaticResource BodyTextStyle}" 
                           FontWeight="SemiBold"/>
                <TextBox x:Name="UsernameTextBox"
                         Text="{x:Bind ViewModel.Username, Mode=TwoWay}"
                         PlaceholderText="Nhập tên đăng nhập"
                         Style="{StaticResource ModernTextBoxStyle}"
                         HorizontalAlignment="Stretch"
                         MinHeight="44"/>
              </StackPanel>

              <!-- Password -->
              <StackPanel Spacing="8">
                <TextBlock Text="Mật khẩu" 
                           Style="{StaticResource BodyTextStyle}" 
                           FontWeight="SemiBold"/>
                <PasswordBox x:Name="PasswordInputBox"
                             PasswordChanged="PasswordBox_PasswordChanged"
                             PlaceholderText="Nhập mật khẩu"
                             Height="48"
                             BorderBrush="{StaticResource BorderBrush}"
                             BorderThickness="2"
                             CornerRadius="{StaticResource BorderRadiusMedium}"
                             Padding="10"
                             HorizontalAlignment="Stretch"/>
              </StackPanel>
            </StackPanel>

            <!-- Error Message -->
            <TextBlock Text="{x:Bind ViewModel.ErrorMessage, Mode=OneWay}"
                       Foreground="{StaticResource ErrorBrush}"
                       FontSize="{StaticResource FontSizeSmall}"
                       TextWrapping="Wrap"
                       HorizontalAlignment="Center"
                       TextAlignment="Center"
                       Visibility="{x:Bind ViewModel.ErrorMessage, Converter={StaticResource StringToVisibilityConverter}}"
                       Margin="0,8,0,0"/>

            <!-- Login Button -->
            <Button Content="Đăng nhập" 
                    Command="{x:Bind ViewModel.LoginCommand}"
                    Style="{StaticResource PrimaryButtonStyle}"
                    HorizontalAlignment="Stretch"
                    MinHeight="48"
                    Margin="0,8,0,0"/>
            
            <!-- Register Link -->
            <StackPanel Spacing="8" Margin="0,12,0,0">
              <TextBlock Text="Chưa có tài khoản?" 
                         FontSize="{StaticResource FontSizeSmall}"
                         Foreground="{StaticResource TextSecondaryBrush}"
                         HorizontalAlignment="Center"
                         TextAlignment="Center"/>
              <Button x:Name="RegisterLinkButton"
                      Content="Đăng ký ngay"
                      Click="RegisterLinkButton_Click"
                      Background="Transparent"
                      BorderThickness="0"
                      Foreground="{StaticResource PrimaryBrush}"
                      FontWeight="SemiBold"
                      HorizontalAlignment="Center"/>
            </StackPanel>
            
            <!-- Footer -->
            <TextBlock Text="Tài khoản demo: Nhập bất kỳ (tối thiểu 3 ký tự)" 
                       FontSize="{StaticResource FontSizeTiny}"
                       Foreground="{StaticResource TextSecondaryBrush}"
                       HorizontalAlignment="Center"
                       TextAlignment="Center"
                       TextWrapping="Wrap"
                       Margin="0,12,0,0"/>
          </StackPanel>
        </Border>
      </StackPanel>
    </ScrollViewer>
    
    <!-- Loading Indicator Overlay -->
    <components:LoadingIndicator IsLoading="{x:Bind ViewModel.IsLoading, Mode=OneWay}"
                               Message="Logging in..."/>
  </Grid>
</Page>


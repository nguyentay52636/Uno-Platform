<Page x:Class="Uno_Platform.Views.AppShell"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:views="using:Uno_Platform.Views"
      Background="{StaticResource BackgroundGradientBrush}">
  
  <Page.Resources>
    <!-- Tab Transition Animations -->
    <Storyboard x:Key="PageEnterAnimation">
      <DoubleAnimation Storyboard.TargetName="ContentFrame"
                      Storyboard.TargetProperty="Opacity"
                      From="0"
                      To="1"
                      Duration="0:0:0.3">
        <DoubleAnimation.EasingFunction>
          <CubicEase EasingMode="EaseOut"/>
        </DoubleAnimation.EasingFunction>
      </DoubleAnimation>
      <DoubleAnimation Storyboard.TargetName="ContentFrame"
                      Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.X)"
                      From="20"
                      To="0"
                      Duration="0:0:0.3">
        <DoubleAnimation.EasingFunction>
          <CubicEase EasingMode="EaseOut"/>
        </DoubleAnimation.EasingFunction>
      </DoubleAnimation>
    </Storyboard>
  </Page.Resources>

  <VisualStateManager.VisualStateGroups>
    <VisualStateGroup x:Name="AdaptiveStates">
      <VisualState x:Name="Mobile">
        <VisualState.StateTriggers>
          <AdaptiveTrigger MinWindowWidth="0"/>
        </VisualState.StateTriggers>
        <VisualState.Setters>
          <Setter Target="AppBar.Padding" Value="12,8"/>
          <Setter Target="AppTitle.FontSize" Value="20"/>
          <Setter Target="TabBar.Padding" Value="0,8,0,8"/>
        </VisualState.Setters>
      </VisualState>
      <VisualState x:Name="Tablet">
        <VisualState.StateTriggers>
          <AdaptiveTrigger MinWindowWidth="641"/>
        </VisualState.StateTriggers>
        <VisualState.Setters>
          <Setter Target="AppBar.Padding" Value="{StaticResource SpacingM}"/>
          <Setter Target="AppTitle.FontSize" Value="24"/>
          <Setter Target="TabBar.Padding" Value="0,8,0,8"/>
        </VisualState.Setters>
      </VisualState>
      <VisualState x:Name="Desktop">
        <VisualState.StateTriggers>
          <AdaptiveTrigger MinWindowWidth="1008"/>
        </VisualState.StateTriggers>
        <VisualState.Setters>
          <Setter Target="AppBar.Padding" Value="{StaticResource SpacingL}"/>
          <Setter Target="AppTitle.FontSize" Value="28"/>
        </VisualState.Setters>
      </VisualState>
    </VisualStateGroup>
  </VisualStateManager.VisualStateGroups>

  <Grid>
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="*"/>
      <RowDefinition Height="Auto"/>
    </Grid.RowDefinitions>

    <!-- Top AppBar with RetailStore centered -->
    <Border Grid.Row="0"
            x:Name="AppBarBorder"
            Background="White"
            Padding="12,28,12,8">

      <Grid ColumnDefinitions="Auto,*,Auto">
        <!-- Toggle Button (Left) -->
        <Button Grid.Column="0"
                x:Name="SidebarToggleButton"
                Click="SidebarToggleButton_Click"
                Style="{StaticResource NoHoverIconButtonStyle}"
                Width="36"
                Height="36"
                VerticalAlignment="Center">
          <FontIcon Glyph="&#xE700;" FontSize="20" Foreground="#367419"/>
        </Button>

        <!-- Brand Name (Center) -->
        <TextBlock Grid.Column="1"
                   x:Name="AppTitle"
                   Text="RetailStore"
                   FontSize="20"
                   FontWeight="Bold"
                   Foreground="#367419"
                   HorizontalAlignment="Center"
                   VerticalAlignment="Center"/>
        
        <!-- Hidden for code-behind -->
        <TextBox x:Name="GlobalSearchBox" 
                 TextChanged="GlobalSearchBox_TextChanged" 
                 Visibility="Collapsed"/>

        <!-- Cart Icon (Right) -->
        <Button Grid.Column="2"
                x:Name="HeaderCartButton"
                Click="CartTab_Click"
                Style="{StaticResource NoHoverIconButtonStyle}"
                Width="36"
                Height="36"
                VerticalAlignment="Center">
          <Grid>
            <SymbolIcon Symbol="Shop" Foreground="#367419"/>
            <Border x:Name="HeaderCartBadge"
                    Background="{StaticResource SecondaryBrush}"
                    CornerRadius="10"
                    Padding="4,2"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Top"
                    Margin="0,-8,-8,0"
                    Visibility="Collapsed">
              <TextBlock x:Name="HeaderCartBadgeText"
                        Text="0"
                        Foreground="White"
                        FontSize="9"
                        FontWeight="Bold"
                        MinWidth="14"
                        TextAlignment="Center"/>
            </Border>
          </Grid>
        </Button>
      </Grid>
    </Border>

    <!-- Main Content Frame -->
    <Frame x:Name="ContentFrame"
           Grid.Row="1"
           Background="Transparent"
           Opacity="0"
           RenderTransformOrigin="0.5,0.5">
      <Frame.RenderTransform>
        <TranslateTransform X="20"/>
      </Frame.RenderTransform>
      <Frame.ContentTransitions>
        <TransitionCollection>
          <ContentThemeTransition/>
        </TransitionCollection>
      </Frame.ContentTransitions>
    </Frame>

    <!-- Bottom Tab Bar with Acrylic Effect -->
    <Border Grid.Row="2"
            x:Name="TabBar"
            Background="{StaticResource AcrylicBrush}"
            Padding="0,8,0,8"
            CornerRadius="16,0,0,0"
            BorderThickness="1,1,0,0"
            BorderBrush="{StaticResource BorderBrush}">
      <Border.Background>
        <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
          <GradientStop Color="#F0FFFFFF" Offset="0"/>
          <GradientStop Color="#F8FFFFFF" Offset="1"/>
        </LinearGradientBrush>
      </Border.Background>

      <Grid>
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="*"/>
          <ColumnDefinition Width="*"/>
          <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- Home Tab -->
        <Button Grid.Column="0"
                x:Name="HomeTab"
                Style="{StaticResource NoHoverIconButtonStyle}"
                Click="HomeTab_Click"
                Tag="Home"
                HorizontalAlignment="Stretch"
                VerticalAlignment="Stretch">
          <StackPanel Spacing="4" HorizontalAlignment="Center" VerticalAlignment="Center">
            <SymbolIcon x:Name="HomeIcon"
                       Symbol="Home"/>
            <TextBlock Text="Home"
                      FontSize="10"
                      HorizontalAlignment="Center"
                      TextWrapping="Wrap"/>
            <Border x:Name="HomeIndicator"
                   Height="3"
                   Width="30"
                   Background="#367419"
                   CornerRadius="1.5"
                   HorizontalAlignment="Center"
                   Opacity="1"
                   Margin="0,4,0,0"/>
          </StackPanel>
        </Button>

        <!-- Cart Tab -->
        <Button Grid.Column="1"
                x:Name="CartTab"
                Style="{StaticResource NoHoverIconButtonStyle}"
                Click="CartTab_Click"
                Tag="Cart"
                HorizontalAlignment="Stretch"
                VerticalAlignment="Stretch">
          <StackPanel Spacing="4" HorizontalAlignment="Center" VerticalAlignment="Center">
            <Grid>
              <SymbolIcon x:Name="CartIcon"
                         Symbol="Shop"/>
              <!-- Cart Badge -->
              <Border x:Name="CartBadge"
                     Background="{StaticResource SecondaryBrush}"
                     CornerRadius="10"
                     Padding="4,2"
                     HorizontalAlignment="Right"
                     VerticalAlignment="Top"
                     Margin="0,-8,0,0"
                     Visibility="Collapsed">
                <TextBlock x:Name="CartBadgeText"
                          Text="0"
                          Foreground="White"
                          FontSize="9"
                          FontWeight="Bold"
                          HorizontalAlignment="Center"
                          VerticalAlignment="Center"
                          MinWidth="16"/>
              </Border>
            </Grid>
            <TextBlock Text="Cart"
                      FontSize="10"
                      HorizontalAlignment="Center"
                      TextWrapping="Wrap"/>
            <Border x:Name="CartIndicator"
                   Height="3"
                   Width="30"
                   Background="#367419"
                   CornerRadius="1.5"
                   HorizontalAlignment="Center"
                   Opacity="0"
                   Margin="0,4,0,0"/>
          </StackPanel>
        </Button>

        <!-- Settings Tab -->
        <Button Grid.Column="2"
                x:Name="SettingsTab"
                Style="{StaticResource NoHoverIconButtonStyle}"
                Click="SettingsTab_Click"
                Tag="Settings"
                HorizontalAlignment="Stretch"
                VerticalAlignment="Stretch">
          <StackPanel Spacing="4" HorizontalAlignment="Center" VerticalAlignment="Center">
            <SymbolIcon x:Name="SettingsIcon"
                       Symbol="Setting"/>
            <TextBlock Text="Settings"
                      FontSize="10"
                      HorizontalAlignment="Center"
                      TextWrapping="Wrap"/>
            <Border x:Name="SettingsIndicator"
                   Height="3"
                   Width="30"
                   Background="#367419"
                   CornerRadius="1.5"
                   HorizontalAlignment="Center"
                   Opacity="0"
                   Margin="0,4,0,0"/>
          </StackPanel>
        </Button>
      </Grid>
    </Border>

    <!-- Toast Notification Container -->
    <Grid x:Name="ToastContainer"
          Grid.Row="0"
          Grid.RowSpan="3"
          HorizontalAlignment="Center"
          VerticalAlignment="Top"
          Margin="0,60,0,0"
          Canvas.ZIndex="500"
          Visibility="Collapsed">
      <Grid.RenderTransform>
        <TranslateTransform x:Name="ToastTransform" Y="-100"/>
      </Grid.RenderTransform>
      
      <!-- Shadow layer -->
      <Border Background="#20000000"
              CornerRadius="14"
              Margin="2,4,2,0"/>
      
      <!-- Main toast container -->
      <Border Background="White"
              CornerRadius="12"
              Padding="16,12"
              MinWidth="280"
              MaxWidth="400"
              BorderThickness="1"
              BorderBrush="#E0E0E0">
        <Grid ColumnDefinitions="Auto,*">
          <!-- Success/Error Icon -->
          <Border x:Name="ToastIconBorder"
                  Grid.Column="0"
                  Width="32"
                  Height="32"
                  CornerRadius="16"
                  Background="#E8F5E9"
                  Margin="0,0,12,0"
                  VerticalAlignment="Center">
            <FontIcon x:Name="ToastIcon"
                      Glyph="&#xE73E;"
                      FontSize="16"
                      Foreground="#367419"
                      HorizontalAlignment="Center"
                      VerticalAlignment="Center"/>
          </Border>
          
          <!-- Message -->
          <TextBlock x:Name="ToastMessage"
                     Grid.Column="1"
                     Text="ÄÃ£ thÃªm vÃ o giá» hÃ ng!"
                     FontSize="14"
                     FontWeight="SemiBold"
                     Foreground="#333333"
                     VerticalAlignment="Center"
                     TextWrapping="Wrap"/>
        </Grid>
      </Border>
    </Grid>

    <!-- Sidebar Overlay (click to close) -->
    <Border x:Name="SidebarOverlay"
            Grid.RowSpan="3"
            Background="#80000000"
            Visibility="Collapsed"
            Canvas.ZIndex="100"
            Tapped="SidebarOverlay_Tapped"/>

    <!-- Sidebar (Navigation Drawer) -->
    <Border x:Name="Sidebar"
            Grid.RowSpan="3"
            Background="#FAFBFC"
            Width="280"
            HorizontalAlignment="Left"
            VerticalAlignment="Stretch"
            BorderBrush="#E5E7EB"
            BorderThickness="0,0,1,0"
            Canvas.ZIndex="200">
      <Border.RenderTransform>
        <TranslateTransform x:Name="SidebarTransform" X="-280"/>
      </Border.RenderTransform>
      
      <Grid RowDefinitions="Auto,*">
        <!-- Sidebar Header -->
        <Border Grid.Row="0" 
                Padding="20"
                Background="#367419">
          <StackPanel Spacing="12">
            <Border Width="70" 
                    Height="70" 
                    CornerRadius="35" 
                    Background="White"
                    HorizontalAlignment="Center">
              <SymbolIcon Symbol="Contact" 
                          Foreground="#367419"
                          RenderTransformOrigin="0.5,0.5">
                <SymbolIcon.RenderTransform>
                  <ScaleTransform ScaleX="1.5" ScaleY="1.5"/>
                </SymbolIcon.RenderTransform>
              </SymbolIcon>
            </Border>
            
            <TextBlock Text="ChÃ o má»«ng!" 
                       FontSize="20"
                       FontWeight="Bold"
                       Foreground="White"
                       HorizontalAlignment="Center"/>
            
            <TextBlock Text="ÄÄƒng nháº­p Ä‘á»ƒ tiáº¿p tá»¥c" 
                       FontSize="14"
                       Foreground="#E0E0E0"
                       HorizontalAlignment="Center"
                       TextAlignment="Center"/>
          </StackPanel>
        </Border>
        
        <!-- Sidebar Content -->
        <StackPanel Grid.Row="1" Padding="20" Spacing="20">
          <!-- Authentication Buttons (2 buttons on same row - Horizontal) -->
          <Grid ColumnDefinitions="*,12,*">
            <Button x:Name="SidebarLoginButton"
                    Grid.Column="0"
                    Content="ÄÄƒng nháº­p"
                    Click="HeaderLoginButton_Click"
                    HorizontalAlignment="Stretch"
                    Height="44"
                    Style="{StaticResource NoHoverPrimaryButtonStyle}"
                    FontSize="14"
                    Padding="16,10"/>
            
            <Button x:Name="SidebarRegisterButton"
                    Grid.Column="2"
                    Content="ÄÄƒng kÃ½"
                    Click="HeaderRegisterButton_Click"
                    HorizontalAlignment="Stretch"
                    Height="44"
                    Style="{StaticResource NoHoverSecondaryButtonStyle}"/>
          </Grid>
          
          <!-- Divider -->
          <Border Height="1" Background="#E5E7EB"/>
          
          <!-- Menu Items -->
          <StackPanel Spacing="4">
            <Button Content="ðŸ   Trang chá»§"
                    Click="HomeTab_Click"
                    HorizontalAlignment="Stretch"
                    HorizontalContentAlignment="Left"
                    Style="{StaticResource NoHoverGhostButtonStyle}"
                    Background="#E8F4E8"
                    Foreground="#367419"
                    FontWeight="SemiBold"/>
            
            <Button Content="ðŸ›ï¸  Sáº£n pháº©m"
                    Click="HomeTab_Click"
                    HorizontalAlignment="Stretch"
                    HorizontalContentAlignment="Left"
                    Style="{StaticResource NoHoverGhostButtonStyle}"/>
            
            <Button Content="ðŸ›’  Giá» hÃ ng"
                    Click="CartTab_Click"
                    HorizontalAlignment="Stretch"
                    HorizontalContentAlignment="Left"
                    Style="{StaticResource NoHoverGhostButtonStyle}"/>
            
            <Button Content="âš™ï¸  CÃ i Ä‘áº·t"
                    Click="SettingsTab_Click"
                    HorizontalAlignment="Stretch"
                    HorizontalContentAlignment="Left"
                    Style="{StaticResource NoHoverGhostButtonStyle}"/>
          </StackPanel>
        </StackPanel>
      </Grid>
    </Border>
  </Grid>
</Page>

